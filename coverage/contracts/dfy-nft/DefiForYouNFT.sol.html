<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\dfy-nft\DefiForYouNFT.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/dfy-nft/</a> DefiForYouNFT.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/33</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/4</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/33</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity ^0.8.4;
&nbsp;
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "@openzeppelin/contracts/utils/Address.sol";
import "../hub/HubInterface.sol";
import "../libs/CommonLib.sol";
&nbsp;
contract DefiForYouNFT is
    ERC721,
    ERC721Enumerable,
    ERC721URIStorage,
    ERC721Burnable,
    AccessControl
{
    using SafeERC20 for IERC20;
    using Counters for Counters.Counter;
    using Address for address;
&nbsp;
    // Define Minter role
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");
&nbsp;
    string public constant CollectionBaseURI =
        "https://defiforyou.mypinata.cloud/ipfs/";
&nbsp;
    Counters.Counter private _tokenIdCounter;
&nbsp;
    address public factory;
    address payable public originalCreator;
    uint256 public defaultRoyaltyRate;
    string public collectionCID;
    mapping(uint256 =&gt; uint256) public royaltyRateByToken;
&nbsp;
    address private _contractHub;
&nbsp;
    event NFTCreated(
        address owner,
        uint256 tokenID,
        uint256 royaltyRate,
        string tokenCID
    );
&nbsp;
    event CollectionRoyaltyRateChanged(
        uint256 previousRoyaltyRate,
        uint256 newRoyaltyRate
    );
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(</span>
        string memory _name,
        string memory _symbol,
        address payable _owner,
        uint256 _royaltyRate,
        string memory _collectionCID,
        address _hub
    ) ERC721(_name, _symbol) {
<span class="cstat-no" title="statement not covered" >        _setupRole(DEFAULT_ADMIN_ROLE, _owner)</span>;
<span class="cstat-no" title="statement not covered" >        _setupRole(MINTER_ROLE, _owner)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        originalCreator = _owner</span>;
<span class="cstat-no" title="statement not covered" >        defaultRoyaltyRate = _royaltyRate</span>;
<span class="cstat-no" title="statement not covered" >        collectionCID = _collectionCID</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (msg.sender.isContract()) {</span>
<span class="cstat-no" title="statement not covered" >            factory = msg.sender</span>;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        _contractHub = _hub</span>;
&nbsp;
        // TODO: Get NFT Sales &amp; Auction addresses from Hub &amp; set approval for all NFTs owned by the owner
    }
&nbsp;
    /**
     * @dev Mint an NFT token and transfer to a user address
     * @param owner is the owner of the token being minted
     * @param royaltyRate is the percentage of the NFT's value that will be paid to the collection creator when it is sold
     * @param tokenCID is the CID string acquired when uploading collection's metadata file to IPFS
     */
<span class="fstat-no" title="function not covered" >    function safeMint(</span>
        address owner,
        uint256 royaltyRate,
        string memory tokenCID
    ) external onlyRole(MINTER_ROLE) {
<span class="cstat-no" title="statement not covered" >        uint256 tokenID = _tokenIdCounter.current();</span>
&nbsp;
        // Get fee wallet &amp; fee token address from Hub
<span class="cstat-no" title="statement not covered" >        (address feeWallet, address feeToken) = HubInterface(_contractHub).getSystemConfig();</span>
&nbsp;
        // Get minting fee from Hub
<span class="cstat-no" title="statement not covered" >        (, uint256 mintingFee) = HubInterface(_contractHub).getNFTCollectionConfig();</span>
&nbsp;
        // Check allowance, balance and transfer minting fee to fee wallet
<span class="cstat-no" title="statement not covered" >        CommonLib.safeTransfer(feeToken, msg.sender, feeWallet, mintingFee)</span>;
&nbsp;
        // Mint NFT token to owner
<span class="cstat-no" title="statement not covered" >        _safeMint(owner, tokenID)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        _setTokenURI(tokenID, tokenCID)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        royaltyRateByToken[tokenID] = royaltyRate</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        _tokenIdCounter.increment()</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit NFTCreated(owner, tokenID, royaltyRate, tokenCID);</span>
    }
&nbsp;
    /**
     * @dev get all tokens held by a user address
     * @param _owner is the token holder
     */
<span class="fstat-no" title="function not covered" >    function tokensOfOwner(address _owner)</span>
        external
        view
        returns (uint256[] memory)
    {
        // get the number of token being hold by _owner
<span class="cstat-no" title="statement not covered" >        uint256 tokenCount = balanceOf(_owner);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (tokenCount == 0) {</span>
            // If _owner has no balance return an empty array
<span class="cstat-no" title="statement not covered" >            return new uint256[](0);</span>
        } else {
            // Query _owner's tokens by index and add them to the token array
<span class="cstat-no" title="statement not covered" >            uint256[] memory tokenList = new uint256[](tokenCount);</span>
<span class="cstat-no" title="statement not covered" >            for (uint256 i = 0; i &lt; tokenCount; i++) {</span>
<span class="cstat-no" title="statement not covered" >                tokenList[i] = tokenOfOwnerByIndex(_owner, i)</span>;
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            return tokenList;</span>
        }
    }
&nbsp;
    /**
     * @dev set the default royalty rate of the collection
     * @param newRoyaltyRate is the value being set as collection's default royalty rate
     */
<span class="fstat-no" title="function not covered" >    function setCollectionDefaultRoyaltyRate(uint256 newRoyaltyRate)</span>
        external
        onlyRole(DEFAULT_ADMIN_ROLE)
    {
<span class="cstat-no" title="statement not covered" >        uint256 currentRoyaltyRate = defaultRoyaltyRate;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        defaultRoyaltyRate = newRoyaltyRate</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit CollectionRoyaltyRateChanged(currentRoyaltyRate, newRoyaltyRate);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function contractURI() public view returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >        return string(abi.encodePacked(_baseURI(), collectionCID));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _baseURI() internal pure override returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >        return CollectionBaseURI;</span>
    }
&nbsp;
    // The following functions are overrides required by Solidity.
&nbsp;
<span class="fstat-no" title="function not covered" >    function _beforeTokenTransfer(</span>
        address from,
        address to,
        uint256 tokenId
    ) internal override(ERC721, ERC721Enumerable) {
<span class="cstat-no" title="statement not covered" >        super._beforeTokenTransfer(from, to, tokenId)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _burn(uint256 tokenId)</span>
        internal
        override(ERC721, ERC721URIStorage)
    {
<span class="cstat-no" title="statement not covered" >        super._burn(tokenId)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function tokenURI(uint256 tokenId)</span>
        public
        view
        override(ERC721, ERC721URIStorage)
        returns (string memory)
    {
<span class="cstat-no" title="statement not covered" >        return super.tokenURI(tokenId);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function supportsInterface(bytes4 interfaceId)</span>
        public
        view
        override(ERC721, ERC721Enumerable, AccessControl)
        returns (bool)
    {
<span class="cstat-no" title="statement not covered" >        return super.supportsInterface(interfaceId);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Feb 21 2022 11:32:14 GMT+0700 (Indochina Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
